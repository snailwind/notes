设计一个存储过程，作用:当需要恢复EMP表时，运行该存储过程，可以直接恢复成原本的样子

1.EMP表没了

--建表

2.数据少了、多了、改了

--添加数据、删除数据、修改数据

3.表结构发生了变化，多加了字段少了字段或改了字段属性(类型或者长度)

--删除字段、增加字段(修改数据)、修改字段属性

--直接让表不存在，重新建表、重现加数据、重新加约束



--删除表  搭配判断语句

`DROP TABLE EMP;`
--建表

`CREATE TABLE EMP...;`

--添加数据

`INSERT INTO EMP ...;`

--添加约束

`ALTER TABLE EMP ...;`



```SQL
CREATE OR REPLACE PROCEDURE SP_REBUILD_EMP 
AUTHID CURRENT_USER IS
  V_CT NUMBER;
BEGIN
  --STEP1:删除表
  BEGIN
    SELECT COUNT(1) INTO V_CT FROM USER_TABLES WHERE TABLE_NAME = 'EMP' ;
    IF V_CT=1 THEN
      EXECUTE IMMEDIATE 'DROP TABLE EMP';
    END IF;
  END;
  DBMS_OUTPUT.PUT_LINE('STEP1,完成');
  --STEP2:建表
  BEGIN 
    EXECUTE IMMEDIATE 'CREATE TABLE EMP
     (EMPNO    NUMBER(4) NOT NULL,
      ENAME    VARCHAR2(10),
      JOB      VARCHAR2(9),
      MGR      NUMBER(4),
      HIREDATE DATE,
      SAL      NUMBER(7,2),
      COMM     NUMBER(7,2),
      DEPTNO   NUMBER(2))';
  END;
  DBMS_OUTPUT.PUT_LINE('STEP2,完成');
  --STEP3:添加数据
  BEGIN 
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7369, ''SMITH'', ''CLERK'', 7902, TO_DATE(''17-12-1980'', ''dd-mm-yyyy''), 800.00, NULL, 20)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7499, ''ALLEN'', ''SALESMAN'', 7698, TO_DATE(''20-02-1981'', ''dd-mm-yyyy''), 1600.00, 300.00, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7522, ''WARD'', ''SALESMAN'', 7698, TO_DATE(''22-02-1981'', ''dd-mm-yyyy''), 1250.00, 500.00, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7566, ''JONES'', ''MANAGER'', 7839, TO_DATE(''02-04-1981'', ''dd-mm-yyyy''), 2975.00, NULL, 20)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7654, ''MARTIN'', ''SALESMAN'', 7698, TO_DATE(''28-09-1981'', ''dd-mm-yyyy''), 1250.00, 1400.00, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7698, ''BLAKE'', ''MANAGER'', 7839, TO_DATE(''01-05-1981'', ''dd-mm-yyyy''), 2850.00, NULL, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7782, ''CLARK'', ''MANAGER'', 7839, TO_DATE(''09-06-1981'', ''dd-mm-yyyy''), 2450.00, NULL, 10)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7788, ''SCOTT'', ''ANALYST'', 7566, TO_DATE(''19-04-1987'', ''dd-mm-yyyy''), 3000.00, NULL, 20)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7839, ''KING'', ''PRESIDENT'', NULL, TO_DATE(''17-11-1981'', ''dd-mm-yyyy''), 5000.00, NULL, 10)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7844, ''TURNER'', ''SALESMAN'', 7698, TO_DATE(''08-09-1981'', ''dd-mm-yyyy''), 1500.00, 0.00, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7876, ''ADAMS'', ''CLERK'', 7788, TO_DATE(''23-05-1987'', ''dd-mm-yyyy''), 1100.00, NULL, 20)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7902, ''FORD'', ''ANALYST'', 7566, TO_DATE(''03-12-1981'', ''dd-mm-yyyy''), 3000.00, NULL, 20)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7904, ''JAMES'', ''CLERK'', 7698, TO_DATE(''03-12-1981'', ''dd-mm-yyyy''), 950.00, NULL, 30)';
    EXECUTE IMMEDIATE 'INSERT INTO EMP VALUES (7934, ''MILLER'', ''CLERK'', 7782, TO_DATE(''23-01-1982'', ''dd-mm-yyyy''), 1300.00, NULL, 10)';
    COMMIT;
  END;
  DBMS_OUTPUT.PUT_LINE('STEP3,完成');
  --STEP4:添加约束
  BEGIN 
    EXECUTE IMMEDIATE 'ALTER TABLE EMP ADD CONSTRAINT PK_EMP PRIMARY KEY (EMPNO)';
    EXECUTE IMMEDIATE 'ALTER TABLE EMP ADD CONSTRAINT FK_DEPTNO FOREIGN KEY (DEPTNO) REFERENCES DEPT (DEPTNO)';
  END;
  DBMS_OUTPUT.PUT_LINE('STEP4,完成');
END SP_REBUILD_EMP;
```

