

```SQL
--创建函数，用来计算指定两个数值的和
SELECT 1+2 FROM DUAL;
CREATE OR REPLACE FUNCTION F_SUM (A NUMBER,B NUMBER)
RETURN NUMBER
AS
S  NUMBER;
BEGIN
  S := NVL(A,0)+NVL(B,0);
  RETURN S;
END ;

SELECT F_SUM(1,2) FROM DUAL;
SELECT ENAME,SAL,COMM,F_SUM(SAL,COMM) FROM EMP;
SELECT ENAME,SAL,COMM,F_SUM(SAL,NVL(COMM,0)) FROM EMP;
```



```SQL
--创建函数，用来计算指定两个数值的差
CREATE OR REPLACE FUNCTION F_DIFF (A NUMBER,B NUMBER)
RETURN NUMBER
AS
BEGIN
  RETURN NVL(A,0)-NVL(B,0);
END ;

SELECT ENAME,SAL,COMM,F_DIFF(SAL,COMM) FROM EMP;
```



```SQL
--创建函数，用来计算指定两个数值的和或差，具体计算方案由第三个参数决定
CREATE OR REPLACE FUNCTION FUN_SF(A NUMBER,B NUMBER,C NUMBER)
RETURN NUMBER
AS
BEGIN
  IF C=1 THEN
    RETURN NVL(A,0)+NVL(B,0);
  ELSIF C=2 THEN
    RETURN NVL(A,0)-NVL(B,0);
  END IF;
  RETURN NVL(A,0)+NVL(B,0);
END;

SELECT ENAME,SAL,COMM,FUN_SF(SAL,COMM,2) FROM EMP;
--当存储函数的执行部分中，第一次出现RETURN时，最终的返回内容就已经确定，后续的内容便不再执行
```



```SQL
--已知有数据字典DATA_DICTIONARY，创建函数，用来输出指定数据类型的编码对应的说明内容
SELECT * FROM DATA_DICTIONARY;
SELECT FUN('企业规模','B') FROM DUAL; ---大型企业
SELECT FUN('行业编码','C') FROM DUAL; --批发零售业

CREATE OR REPLACE FUNCTION F_DD (I_DATA_TYPE VARCHAR2 ,I_DATA_CODE VARCHAR2)
RETURN VARCHAR2
AS
V_DATA_DESC  VARCHAR2(200);
BEGIN
  SELECT DATA_DESC INTO V_DATA_DESC FROM DATA_DICTIONARY WHERE DATA_TYPE = I_DATA_TYPE AND DATA_CODE = I_DATA_CODE;
  RETURN V_DATA_DESC;
END;

SELECT F_DD('企业规模','B') FROM DUAL; ---大型企业
SELECT F_DD('行业编码','C') FROM DUAL; --批发零售业
SELECT F_DD('企业规模','Q') FROM DUAL; 
--在SQL语句中使用存储函数时，若函数运行出错，不一定会通过弹窗报错提醒
```



```SQL
--已有用户信息表USER_INFO，创建函数，用来验证输入的用户名及密码是否正确
CREATE TABLE USER_INFO (
USER_NAME  VARCHAR2(100),
PWD        VARCHAR2(100) );
SELECT * FROM USER_INFO FOR UPDATE;
SELECT FUN('lisi','lisi') FROM DUAL;  --验证通过
SELECT FUN('lisi','LISI') FROM DUAL;  --密码错误
SELECT FUN('LISI','lisi') FROM DUAL;  --验证通过
SELECT FUN('liliu','lisi') FROM DUAL; --用户名不存在

CREATE OR REPLACE FUNCTION F_UI (I_USER_NAME VARCHAR2,I_PWD VARCHAR2)
RETURN VARCHAR2
IS 
V_RESULT  VARCHAR2(200);
V_CT      NUMBER       ;
BEGIN
  SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME);
  IF V_CT > 0 THEN
    SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME) AND PWD = I_PWD;
    IF V_CT > 0 THEN 
      RETURN '验证通过';
    ELSE
      RETURN '密码错误';
    END IF;
  ELSE
    V_RESULT := '用户名不存在';
    RETURN V_RESULT;
  END IF;
END;

SELECT F_UI('zhangsansan','zzzs') FROM DUAL;
```



```SQL
SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME) AND PWD = I_PWD;
SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME);

CREATE OR REPLACE FUNCTION F_UI (I_USER_NAME VARCHAR2,I_PWD VARCHAR2)
RETURN VARCHAR2
IS 
V_RESULT  VARCHAR2(200);
V_CT      NUMBER       ;
BEGIN
  SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME) AND PWD = I_PWD;
  IF V_CT = 1 THEN
    RETURN '验证通过';
  ELSE
    SELECT COUNT(*) INTO V_CT FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME);
    IF V_CT = 1 THEN
      RETURN '密码错误';
    ELSE 
      RETURN '用户名不存在';
    END IF;
  END IF;
END;
```



```SQL
CREATE OR REPLACE FUNCTION F_UI (I_USER_NAME VARCHAR2,I_PWD VARCHAR2)
RETURN VARCHAR2
IS 
V_CT1      NUMBER       ;
V_PWD      VARCHAR2(200);
BEGIN
  SELECT COUNT(*) INTO V_CT1 FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME);
  SELECT PWD INTO V_PWD FROM USER_INFO WHERE UPPER(USER_NAME) = UPPER(I_USER_NAME);
  IF V_CT1 = 1 THEN
    IF V_PWD = I_PWD THEN
      RETURN '验证通过';
    ELSE 
      RETURN '密码错误';
    END IF;
  ELSE
    RETURN '用户名不存在';
  END IF;
END;
```

